<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario Interactivo</title>
    <style>
        /* ... (mantener los estilos existentes) ... */
        .calendario {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 20px;
        }
        .calendario div {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
            cursor: pointer;
        }
        .calendario .header {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
        }
        .calendario .weekend {
            background-color: #f0f0f0;
        }
        .calendario .selected-red {
            background-color: #ffcccc;
        }
        .calendario .selected-yellow {
            background-color: #ffffcc;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Calendario Interactivo - Selección de Disponibilidad</h2>
        <div class="form-group">
            <label for="medico">Seleccionar Médico:</label>
            <select id="medico" onchange="cargarCalendario()"></select>
        </div>
        <div class="form-group">
            <label for="mes">Mes:</label>
            <select id="mes" onchange="generarCalendario()">
                <option value="0">Enero</option>
                <option value="1">Febrero</option>
                <option value="2">Marzo</option>
                <option value="3">Abril</option>
                <option value="4">Mayo</option>
                <option value="5">Junio</option>
                <option value="6">Julio</option>
                <option value="7">Agosto</option>
                <option value="8">Septiembre</option>
                <option value="9">Octubre</option>
                <option value="10">Noviembre</option>
                <option value="11">Diciembre</option>
            </select>

            <label for="anio">Año:</label>
            <select id="anio" onchange="generarCalendario()"></select>
        </div>

        <button class="btn-save" onclick="guardarCambios()">Guardar cambios</button>

        <div class="calendario" id="calendario"></div>

        <nav>
            <a href="index.html">Volver al Inicio</a>
        </nav>
    </div>

    <script>
        const medicoSelect = document.getElementById('medico');
        const calendarioDiv = document.getElementById('calendario');
        const mesSelect = document.getElementById('mes');
        const anioSelect = document.getElementById('anio');
        let calendarioSeleccion = {};

        window.onload = function() {
            cargarMedicos();
            cargarAnios();
            cargarCalendario();
        };

        function cargarMedicos() {
            const medicos = JSON.parse(localStorage.getItem('medicos')) || [];
            medicoSelect.innerHTML = '<option value="">Seleccione un médico</option>';
            medicos.forEach(medico => {
                const option = document.createElement('option');
                option.value = medico.correo;
                option.textContent = `${medico.nombre} ${medico.apellidos}`;
                medicoSelect.appendChild(option);
            });
        }

        function cargarAnios() {
            const anioActual = new Date().getFullYear();
            for (let i = anioActual - 2; i <= anioActual + 2; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                anioSelect.appendChild(option);
            }
            anioSelect.value = anioActual;
        }

        function cargarCalendario() {
            const correoMedico = medicoSelect.value;
            if (correoMedico) {
                calendarioSeleccion = JSON.parse(localStorage.getItem(correoMedico)) || {};
            } else {
                calendarioSeleccion = {};
            }
            generarCalendario();
        }

        function generarCalendario() {
            const mes = parseInt(mesSelect.value);
            const anio = parseInt(anioSelect.value);
            const correoMedico = medicoSelect.value;

            if (!correoMedico) {
                calendarioDiv.innerHTML = '<p>Por favor, seleccione un médico.</p>';
                return;
            }

            const diasSemana = ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'];
            const primerDia = new Date(anio, mes, 1).getDay();
            const ultimoDia = new Date(anio, mes + 1, 0).getDate();

            let calendarioHTML = diasSemana.map(dia => `<div class="header">${dia}</div>`).join('');

            let diaActual = 1;
            for (let i = 0; i < 42; i++) {
                if (i < (primerDia === 0 ? 6 : primerDia - 1) || diaActual > ultimoDia) {
                    calendarioHTML += '<div></div>';
                } else {
                    const fecha = `${anio}-${(mes + 1).toString().padStart(2, '0')}-${diaActual.toString().padStart(2, '0')}`;
                    const clase = calendarioSeleccion[fecha] === 'rojo' ? 'selected-red' : 
                                  calendarioSeleccion[fecha] === 'amarillo' ? 'selected-yellow' : '';
                    const esFinDeSemana = i % 7 === 5 || i % 7 === 6 ? 'weekend' : '';
                    calendarioHTML += `<div class="day ${esFinDeSemana} ${clase}" onclick="seleccionarDia(this, '${fecha}')">${diaActual}</div>`;
                    diaActual++;
                }
            }

            calendarioDiv.innerHTML = calendarioHTML;
        }

        function seleccionarDia(elemento, fecha) {
            if (elemento.classList.contains('selected-red')) {
                elemento.classList.remove('selected-red');
                elemento.classList.add('selected-yellow');
                calendarioSeleccion[fecha] = 'amarillo';
            } else if (elemento.classList.contains('selected-yellow')) {
                elemento.classList.remove('selected-yellow');
                delete calendarioSeleccion[fecha];
            } else {
                elemento.classList.add('selected-red');
                calendarioSeleccion[fecha] = 'rojo';
            }
        }

        function guardarCambios() {
            const correoMedico = medicoSelect.value;
            if (!correoMedico) {
                alert("Por favor, selecciona un médico.");
                return;
            }
            localStorage.setItem(correoMedico, JSON.stringify(calendarioSeleccion));
            alert("Cambios guardados correctamente.");
        }

        // Inicializar el calendario al cargar la página
        generarCalendario();
    </script>
</body>
</html>
